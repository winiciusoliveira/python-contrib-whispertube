# Transcrever.py

import os
import whisper


def transcrever_audio(mp3_file, output_dir):
    """Transcreve o áudio usando Whisper e salva em um arquivo TXT."""
    if mp3_file is None or not os.path.exists(mp3_file):
        print("Erro: Arquivo MP3 não encontrado!")
        return None

    txt_output_dir = os.path.join(output_dir, "txt")

    if not os.path.exists(txt_output_dir):
        os.makedirs(txt_output_dir)

    transcription_file = os.path.join(txt_output_dir, os.path.basename(mp3_file).rsplit('.', 1)[0] + ".txt")

    print("Transcrevendo áudio...")
    model = whisper.load_model("small")
    result = model.transcribe(mp3_file)

    with open(transcription_file, "w", encoding="utf-8") as f:
        f.write(result["text"])

    print("Transcrição salva em:", transcription_file)
    return transcription_file
